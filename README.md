# RMNO5 - 5号机器人代码

## 项目概述

这是重庆大学机器人战队5号机器人使用 STM32F4 开发板开发的控制代码。该代码由我独立开发，基于达妙的 STM32F4 开发板，涵盖了多个模块，包括核心控制、驱动、USB 设备接口、应用层代码等。机器人底盘使用麦轮，通过 CAN 通信与上板进行通信，底盘控制采用 PID 控制。遥控命令通过中断接收，并通过 CAN 通信传输给下板。同时，下板控制云台电机，而上板负责发射轮和发射姿态控制以及拨盘电机的控制，使用大疆3508电机。

### 主要新增功能：
1. **大疆 C 板控制**：上板通过 CAN 总线连接两个摩擦轮控制电机，分别控制上下枪口电机、拨弹电机和弹舱开闭。
2. **视觉自瞄**：加入了视觉自瞄系统，通过相机获取目标位置并进行自瞄调整。
3. **裁判系统**：集成裁判系统，用于实时监控比赛状态和机器人得分。

## 项目结构
up是上c板的代码
nb是底盘板子代码

## 主要功能

1. **底盘控制**：
   - 底盘使用麦轮，通过 PID 控制电机的速度与位置，实现精准的轨迹跟踪和转向控制。
   - 控制命令通过 CAN 总线进行接收与传输。

2. **CAN 通信**：
   - 上板和下板通过 CAN 通信进行双向数据交换。
   - 上板通过 CAN 向下板发送控制命令，下板接收并执行控制。
   - 上板控制两个摩擦轮电机，用于控制上下枪口电机、拨弹电机和弹舱开闭。

3. **遥控命令**：
   - 遥控指令通过中断机制接收，处理后通过 CAN 通信传送给下板。

4. **云台控制**：
   - 下板控制云台电机的运动，实现视角调节。

5. **发射轮控制**：
   - 上板控制发射轮的运动，通过 PID 控制电机速度。

6. **发射姿态控制与拨盘控制**：
   - 上板负责发射姿态控制及拨盘电机的控制，确保发射的精度和准确性。

7. **大疆3508电机驱动**：
   - 使用大疆3508电机进行动力输出，适用于需要高精度、高功率的控制任务。

8. **视觉自瞄**：
   - 使用相机进行目标检测，结合机器人的运动状态，实现自动瞄准目标。

9. **裁判系统**：
   - 通过与裁判系统接口实时获取比赛状态和得分信息，确保比赛的公平性。

## 使用说明

### 硬件平台

- **主控板**：STM32F4系列开发板
- **电机驱动**：大疆3508电机驱动
- **底盘驱动**：麦轮
- **CAN通信**：用于上下板间的数据交换与控制
- **遥控命令接收**：通过中断处理
- **视觉系统**：通过相机实现目标识别和自瞄

### 开发环境

- **开发环境**：Keil MDK-ARM
- **硬件调试工具**：ST-Link V2（用于STM32F4的下载和调试）
- **串口调试**：使用串口连接进行调试和数据输出
- **中断配置**：通过 STM32 的中断机制来接收遥控命令

### 安装步骤

克隆本仓库：
   ```bash
   git clone https://github.com/liu4207/RMNOS.git
   ```
### 控制系统
PID 控制：底盘控制使用 PID 算法调节电机的线速度与角速度，保证机器人的平稳行驶。

CAN 通信：上下板之间的通信使用标准的 CAN 协议，确保数据交换的实时性和可靠性。

遥控命令：通过中断接收遥控命令，在实时性要求较高的情况下，及时响应并传输数据。

大疆3508电机控制：大疆3508电机的控制通过 PWM 调节，确保电机响应迅速且稳定。

### 详细模块说明
1. 底盘控制（麦轮）
控制底盘麦轮的运动，通过 PID 控制算法调节电机的速度和转向。

PID 参数可根据不同的运动需求进行调整，以优化机器人运动的稳定性和精度。

2. CAN 通信
上下板通信：上下板之间通过 CAN 总线传输控制命令和传感器数据，实现机器人全局的同步控制。

数据格式：数据传输采用特定的数据帧结构，确保数据的完整性和可靠性。

摩擦轮控制：上板控制两个摩擦轮电机，分别控制上下枪口电机、拨弹电机和弹舱开闭。

3. 遥控命令
遥控命令通过中断接收，确保系统能够实时响应遥控指令。

接收到的命令通过 CAN 通信传输给下板，进行后续的动作执行。

4. 云台控制
下板控制云台电机，实现视角的调节，支持多角度的定位和控制。

5. 发射轮与拨盘控制
上板控制发射轮和拨盘电机，确保发射的精准性和控制的响应性。

6. 视觉自瞄
通过相机获取目标位置，并根据目标位置调整机器人的瞄准角度，实现自动瞄准功能。

结合视觉反馈和运动控制算法，确保机器人精准发射。

7. 裁判系统
与裁判系统接口实时监控比赛状态和得分情况，保证比赛过程中的公平性。

提供比赛状态查询和分数统计接口，确保比赛结果的准确性。

